<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üß†</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
/* ===================== BASIC ===================== */
html, body { height: 100%; margin: 0; }
body {
  display: grid; place-items: center;
  background: #000; color: white;
  font-family: Arial, sans-serif; text-align: center;
}
#gameContainer {
  width: 90%; max-width: 700px; min-height: 520px;
  padding: 20px; background: #000; border-radius: 15px;
  box-shadow: 0 0 25px rgba(255,255,255,0.08);
  display: flex; flex-direction: column; align-items: center; justify-content: center;
}
h1 {
  font-size: 1.8em;
  margin-bottom: 20px;
  color: #4dd0e1;
  font-family: 'Press Start 2P', cursive;
}

/* ===================== HELP BUTTON ===================== */
#helpBtn{
  position:absolute;
  top:15px; right:15px;
  width:40px; height:40px;
  border-radius:50%;
  background:#4dd0e1;
  color:black;
  font-weight:bold;
  cursor:pointer;
}
#helpBox{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:99;
}
#helpContent{
  background:#111;
  border-radius:15px;
  padding:25px;
  max-width:500px;
  font-size:0.9em;
}
#helpContent button{
  margin-top:15px;
  background:#f44336;
}

/* ===================== GAME UI ===================== */
#task,#wordDisplay{font-size:1.4em;margin:20px 0;font-family:'Press Start 2P',cursive;}
#inputContainer{display:flex;flex-direction:column;align-items:center;}
#playerWord,#answer{width:80%;max-width:400px;padding:10px;border-radius:10px;border:none;margin-bottom:15px;text-align:center;}
button{padding:12px 25px;border-radius:10px;background:#2e7d32;color:white;border:none;cursor:pointer;}
button:hover{background:#4caf50;}
#message{margin-top:20px;min-height:40px;}
#timer{margin-top:15px;font-weight:bold;}
.timer-green{color:#4caf50;}
.timer-yellow{color:#ffc107;}
.timer-red{color:#f44336;}

/* ===================== TIC TAC TOE ===================== */
#board{display:grid;grid-template-columns:repeat(3,120px);grid-template-rows:repeat(3,120px);gap:12px;}
.cell{width:120px;height:120px;font-size:48px;display:flex;align-items:center;justify-content:center;border-radius:15px;font-weight:bold;cursor:pointer;}
</style>
</head>

<body>

<button id="helpBtn" onclick="openHelp()">?</button>

<div id="helpBox">
  <div id="helpContent">
    <div id="helpText"></div>
    <button onclick="closeHelp()">Close</button>
  </div>
</div>

<div id="gameContainer">
  <h1>üß†</h1>
  <button onclick="startWordChain()">START</button>
</div>

<script>
// ========================== VARIABLES ==========================
let stage='start', wordScore=0;
let currentWord='', usedWords=[], wordList=[];
let board=[], gameOver=false;

// ========================== HELP SYSTEM ==========================
function openHelp(){
  let text='';
  if(stage==='start') text='Press START to begin the brain trial.';
  else if(stage==='word') text='Word Chain: Use the last letter of the previous word.';
  else if(stage==='tic') text='Tic Tac Toe: Win 3 rounds before the AI.';
  else if(stage==='math') text='Solve math tasks quickly and correctly.';
  else if(stage==='chromatic') text='Make all tiles the same target color.';
  document.getElementById('helpText').textContent=text;
  document.getElementById('helpBox').style.display='flex';
}
function closeHelp(){
  document.getElementById('helpBox').style.display='none';
}

// ========================== WORD CHAIN ==========================
function startWordChain(){
  stage='word';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="wordDisplay">Apple</div>
    <div id="inputContainer">
      <input id="playerWord" autocomplete="off">
      <button onclick="playWord()">OK</button>
    </div>
    <div id="message"></div>
  `;
  currentWord='Apple';
  usedWords=[currentWord];
  wordList=["Apple","Elephant","Tiger","Rabbit","Tree","Eagle","Egg","Giraffe"];
}

function playWord(){
  const input=document.getElementById('playerWord');
  const msg=document.getElementById('message');
  let w=input.value.trim();
  if(!w)return;
  if(w[0].toLowerCase()!==currentWord.slice(-1).toLowerCase()){
    msg.textContent='‚ùå Wrong!';
    return;
  }
  usedWords.push(w);
  currentWord=w;
  document.getElementById('wordDisplay').textContent=currentWord;
  input.value='';
  setTimeout(aiTurn,500);
}

function aiTurn(){
  wordScore++;
  if(wordScore>=6) setTimeout(startTicTacToe,800);
}

// ========================== TIC TAC TOE ==========================
function startTicTacToe(){
  stage='tic';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="board"></div>
    <div id="message"></div>
  `;
  board=['','','','','','','','',''];
  renderBoard();
}

function renderBoard(){
  const b=document.getElementById('board');
  b.innerHTML='';
  board.forEach((v,i)=>{
    const d=document.createElement('div');
    d.className='cell';
    d.textContent=v;
    d.onclick=()=>playerMove(i);
    b.appendChild(d);
  });
}

function playerMove(i){
  if(board[i]!=='')return;
  board[i]='X';
  renderBoard();
}
  // ========================== TIC TAC TOE (CONTINUED) ==========================
let ticScore={player:0,ai:0,draw:0};
let timer=6, timerInterval;

function aiMove(){
  const empty=board.map((v,i)=>v===''?i:null).filter(v=>v!==null);
  if(!empty.length) return;
  board[empty[Math.floor(Math.random()*empty.length)]]='O';
  renderBoard();
  startTimer();
}

function startTimer(){
  clearInterval(timerInterval);
  timer=6;
  timerInterval=setInterval(()=>{
    timer--;
    if(timer<=0){
      clearInterval(timerInterval);
      aiMove();
    }
  },1000);
}

// ========================== MATH CHALLENGE ==========================
let correctAnswer=0, correctMathCount=0;
let mathTimer=30, mathTimerInterval;

function startMathChallenge(){
  stage='math';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="task"></div>
    <div id="inputContainer">
      <input id="answer" type="number">
      <button onclick="checkMathAnswer()">OK</button>
    </div>
    <div id="timer"></div>
    <div id="message"></div>
  `;
  generateMathTask();
  startMathTimer();
}

function generateMathTask(){
  const a=Math.floor(Math.random()*20)+10;
  const b=Math.floor(Math.random()*10)+2;
  correctAnswer=a+b;
  document.getElementById('task').textContent=`${a} + ${b} = ?`;
}

function startMathTimer(){
  clearInterval(mathTimerInterval);
  mathTimer=30;
  mathTimerInterval=setInterval(()=>{
    mathTimer--;
    document.getElementById('timer').textContent=`‚è≥ ${mathTimer}`;
    if(mathTimer<=0) restartGame();
  },1000);
}

function checkMathAnswer(){
  const v=document.getElementById('answer').value;
  if(Number(v)===correctAnswer){
    correctMathCount++;
    if(correctMathCount>=3) setTimeout(startChromaticTrial,700);
    else generateMathTask();
  } else restartGame();
}

// ========================== CHROMATIC TRIAL ==========================
const colorsCT=["#e57373","#64b5f6","#81c784","#fff176","#ba68c8"];
const CHROMATIC_GOAL="#ba68c8";
let tilesCT=[], chromaticTimer=60, chromaticInterval;

function startChromaticTrial(){
  stage='chromatic';
  const c=document.getElementById('gameContainer');
  c.innerHTML=`
    <h1></h1>
    <div id="grid"></div>
    <div id="timer"></div>
  `;
  createGrid();
  startChromaticTimer();
}

function createGrid(){
  const g=document.getElementById('grid');
  g.innerHTML='';
  tilesCT=[];
  for(let i=0;i<9;i++){
    const t=document.createElement('div');
    t.className='tile';
    const idx=Math.floor(Math.random()*colorsCT.length);
    t.dataset.color=idx;
    t.style.backgroundColor=colorsCT[idx];
    t.onclick=()=>{cycleColor(t); checkChromaticWin();};
    tilesCT.push(t);
    g.appendChild(t);
  }
}

function cycleColor(tile){
  let i=Number(tile.dataset.color);
  i=(i+1)%colorsCT.length;
  tile.dataset.color=i;
  tile.style.backgroundColor=colorsCT[i];
}

function checkChromaticWin(){
  if(tilesCT.every(t=>colorsCT[t.dataset.color]===CHROMATIC_GOAL)){
    clearInterval(chromaticInterval);
    setTimeout(restartGame,500);
  }
}

function startChromaticTimer(){
  clearInterval(chromaticInterval);
  chromaticTimer=60;
  chromaticInterval=setInterval(()=>{
    chromaticTimer--;
    document.getElementById('timer').textContent=`‚è≥ ${chromaticTimer}`;
    if(chromaticTimer<=0) restartGame();
  },1000);
}

// ========================== RESTART ==========================
function restartGame(){
  clearInterval(timerInterval);
  clearInterval(mathTimerInterval);
  clearInterval(chromaticInterval);

  stage='start';
  wordScore=0;
  correctMathCount=0;
  board=[];

  document.getElementById('gameContainer').innerHTML=`
    <h1>üß†</h1>
    <button onclick="startWordChain()">START</button>
  `;
}
</script>
</body>
</html>
